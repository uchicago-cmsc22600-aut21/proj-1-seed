# Makefile for project 1
#
# CMSC 22600 --- Compilers for Computer Languages
# Autumn 2021
# University of Chicago
#
# COPYRIGHT (c) 2021 John Reppy (http://cs.uchicago.edu/~jhr)
# All rights reserved.
#
# targets:
#	make mlc	-- Build ML Lite compiler
#	make clean	-- remove intermediate files
#

SHELL =         /bin/sh

# we assume that sml (and thus ml-build is in the path)
#
ML_BUILD =	ml-build

HEAP_SUFFIX =	$(shell sml @SMLsuffix)

COMPILER =	mlc

BIN_DIR =	../bin

CM_FILES =	$(wildcard */sources.cm)
HEAP =		$(COMPILER).$(HEAP_SUFFIX)
TARGET =	$(BIN_DIR)/$(HEAP)

SRCS =		common/error.sml \
		driver/main.sml \
		driver/options.sml \
		parser/parser.sml \
		parser/mll-tokens.sml \
		parser/mll.lex

# build rule for compiler
$(TARGET):	$(CM_FILES) $(SRCS)
	$(ML_BUILD) driver/sources.cm Main.main $(COMPILER)
	mv $(HEAP) $(TARGET)

# remove generated files (including the files generated by ml-antlr and ml-ulex)
#
.PHONY:		clean
clean:
		rm -f $(TARGET)
		rm -rf .cm */.cm
		rm -f parser/mll.lex.sml
